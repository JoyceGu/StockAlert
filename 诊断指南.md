# Vercel 部署问题诊断指南

## 🔍 为什么图表不显示？

### 快速诊断步骤：

#### 1. 打开浏览器开发者工具
- 按 **F12** 或 **Cmd+Option+I** (Mac)
- 查看 **Console（控制台）** 标签

#### 2. 检查错误信息

**常见错误**：

**错误A：`Failed to fetch` 或 `NetworkError`**
- **原因**：API端点无法访问
- **解决**：检查Vercel部署是否成功，API路由是否正确

**错误B：`Cannot GET /api/stock/AAPL`**
- **原因**：Vercel路由配置问题
- **解决**：确保 `vercel.json` 文件存在且配置正确

**错误C：`Chart is not defined`**
- **原因**：Chart.js库未加载
- **解决**：检查网络连接，CDN是否可访问

**错误D：`Loading stock data...` 一直显示**
- **原因**：API调用超时或失败
- **解决**：查看Network标签，检查API请求状态

---

## 🔧 手动测试API

在浏览器地址栏输入：

```
https://your-app.vercel.app/api/health
```

**应该返回**：
```json
{
  "status": "OK",
  "timestamp": "...",
  "uptime": ...
}
```

如果返回404，说明API路由配置有问题。

---

## 📊 检查Network请求

1. 打开开发者工具 → **Network（网络）** 标签
2. 刷新页面
3. 查找以下请求：

**应该成功的请求**：
- ✅ `/api/stock/VOO` → 状态码 200
- ✅ `/api/stock/QQQ` → 状态码 200
- ✅ `styles.css` → 状态码 200
- ✅ `script.js` → 状态码 200

**如果看到404**：
- API路由配置问题
- 检查 `vercel.json`

**如果看到500**：
- 服务器端错误
- 查看Vercel函数日志

---

## 🐛 常见问题修复

### 问题1：vercel.json 配置错误

**检查**：
```bash
# 确保文件存在
ls vercel.json

# 检查内容
cat vercel.json
```

**应该包含**：
```json
{
  "version": 2,
  "builds": [
    {
      "src": "server.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/server.js"
    },
    {
      "src": "/(.*)",
      "dest": "/server.js"
    }
  ]
}
```

### 问题2：server.js 导出问题

**检查** `server.js` 文件末尾：

```javascript
// 应该包含
module.exports = app;

// Vercel环境检测
if (process.env.VERCEL !== '1') {
    app.listen(PORT, ...);
}
```

### 问题3：静态文件路径

**确保**：
- `index.html` 在根目录
- `styles.css` 在根目录
- `script.js` 在根目录

---

## 🚀 重新部署

如果问题持续：

```bash
# 方法1：强制重新部署
vercel --force

# 方法2：删除并重新部署
vercel remove your-project-name
vercel

# 方法3：通过GitHub
# 推送新提交，Vercel会自动重新部署
git add .
git commit -m "Fix deployment"
git push
```

---

## 📝 检查Vercel日志

1. 登录 [Vercel Dashboard](https://vercel.com/dashboard)
2. 选择你的项目
3. 点击 **Functions** 标签
4. 查看 `server.js` 的日志

**查找**：
- ✅ `🚀 Stock Alert Server running` - 正常
- ❌ `Error fetching data` - API错误
- ❌ `No data found` - 股票代码问题

---

## ✅ 验证清单

部署后逐一检查：

- [ ] `vercel.json` 文件存在
- [ ] `server.js` 在根目录
- [ ] `/api/health` 返回200
- [ ] `/api/stock/AAPL` 返回股票数据
- [ ] 浏览器控制台无错误
- [ ] Network标签显示请求成功
- [ ] Chart.js库加载成功

---

## 🆘 如果仍然无法解决

### 步骤1：测试本地运行

```bash
npm start
# 访问 http://localhost:3000
```

如果本地工作正常，问题在Vercel配置。

### 步骤2：检查Vercel Dashboard

- **Deployments** → 查看最新部署状态
- **Functions** → 查看函数日志
- **Settings** → 检查环境变量

### 步骤3：简化测试

创建一个简单的测试端点：

```javascript
// 在 server.js 中添加
app.get('/api/test', (req, res) => {
    res.json({ message: 'API is working!' });
});
```

访问 `https://your-app.vercel.app/api/test`

如果这个工作，说明路由配置正确，问题在股票API。

---

## 📚 有用的命令

```bash
# 查看Vercel项目信息
vercel ls

# 查看部署日志
vercel logs

# 本地测试Vercel环境
vercel dev
```

---

**按照以上步骤逐一检查，应该能找到问题所在！** 🔍
